# TTI ,Smart Transportation Industry Standard! 

# <img src="imgs/va-logo.png" width="200px" align="center" alt="TTI"/>
[![license](http://img.shields.io/badge/license-Apache2.0-brightgreen.svg?style=flat)](https://github.com/didi/VirtualAPK/blob/master/LICENSE)
[![Release Version](https://img.shields.io/badge/release-0.9.8-red.svg)](https://github.com/didi/VirtualAPK/releases)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)](https://github.com/didi/VirtualAPK/pulls)

The TTI (Travel Time Index) industry's most used evaluation index of urban 
congestion degree is the ratio of the actual travel time and the free flow time.
The larger the value, the worse the traffic operation status, and the congestion 
level is generally positive. Related, other abnormal weather conditions (such as rain, snow, fog, etc.)
or abnormal road conditions may also affect the value of TTI.


# Calculation method of traffic index
![TTI](method.jpg)
# Data curves of Beijing and Urumqi
![TTI](demo.jpg)

# Required data

| Feature | Detail |
|:-------------|:-------------:|
| Road network data | Basic map road network data, including road shape and unique id |
| Realtime Traffic data | Relying on dripping massive floating car data, real-time traffic data released by Didi |
| Free flow data | From the Drip Trajectory database, the road speed generated by the excavation |
| weight data | The total number of vehicles passing the road within a natural month |

# Getting started

## GAIA Open Dataset
With DiDi's advantages in big data and technology, the GAIA Initiative provides academic community with real-life application use cases, anonymized data and computing resources, and seeks collaboration with the academic community. The Initiative aims to advance fundamental and prospective studies in transportation research. It promotes the application of scientific achievements by strengthening ties between industry, university and research. This effort will drive scientific development in intelligent transportation systems and contribute to societal development.With DiDi's advantages in big data and technology, the GAIA Initiative provides academic community with real-life application use cases, anonymized data and computing resources, and seeks collaboration with the academic community. The Initiative aims to advance fundamental and prospective studies in transportation research. It promotes the application of scientific achievements by strengthening ties between industry, university and research. This effort will drive scientific development in intelligent transportation systems and contribute to societal development.

Add a realtime traffic data API in `config.conf` in root of host project as following.

``` c++
dependencies {
    realtime_traffic_data 'http://sts.didichuxing.com/api/realtime?citycode=1'
    roadnet 'http://sts.didichuxing.com/api/roadnet?citycode=1'
    freeflow 'http://sts.didichuxing.com/api/freeflow?link_id=10001'
    weight 'http://sts.didichuxing.com/api/weight?link_id=10001'
}
```

Apply plugin in application module of `build.gradle`.

```
apply plugin: 'com.didi.virtualapk.host'
```

Compile VirtualAPK in application module of `build.gradle`.

``` java
compile 'com.didi.virtualapk:core:0.9.8'
```

Initialize `PluginManager` in `YourApplication::attachBaseContext()`.

``` java
@Override
protected void attachBaseContext(Context base) {
    super.attachBaseContext(base);
    PluginManager.getInstance(base).init();
}
```

Modify proguard rules to keep VirtualAPK related files.

```
-keep class com.didi.virtualapk.internal.VAInstrumentation { *; }
-keep class com.didi.virtualapk.internal.PluginContentResolver { *; }

-dontwarn com.didi.virtualapk.**
-dontwarn android.**
-keep class android.** { *; }
```

Finally, load an APK and have fun!

``` java
String pluginPath = Environment.getExternalStorageDirectory().getAbsolutePath().concat("/Test.apk");
File plugin = new File(pluginPath);
PluginManager.getInstance(base).loadPlugin(plugin);

// Given "com.didi.virtualapk.demo" is the package name of plugin APK, 
// and there is an activity called `MainActivity`.
Intent intent = new Intent();
intent.setClassName("com.didi.virtualapk.demo", "com.didi.virtualapk.demo.MainActivity");
startActivity(intent);
```

## Plugin Project

Add a dependency in `build.gradle` in root of plugin project as following.

``` java
dependencies {
    classpath 'com.didi.virtualapk:gradle:0.9.8.6'
}
```

Apply plugin in application module of `build.gradle`.

```
apply plugin: 'com.didi.virtualapk.plugin'
```

Config VirtualAPK. Remember to put following lines at the end of `build.gradle`.

```
virtualApk {
    packageId = 0x6f             // The package id of Resources.
    targetHost='source/host/app' // The path of application module in host project.
    applyHostMapping = true      // [Optional] Default value is true. 
}
```

# Developer guide

* API document [wiki](https://github.com/didi/VirtualAPK/wiki)
* Sample project [PluginDemo](https://github.com/didi/VirtualAPK/tree/master/PluginDemo)
* Read [core library source code](https://github.com/didi/VirtualAPK/tree/master/CoreLibrary)
* Read [Release notes](RELEASE-NOTES.md)

# Known issues

* Notifications with custom layout are not supported in plugin.
* Transition animations with animation resources are not supported in plugin.

# Contributing

Welcome to contribute by creating issues or sending pull requests. See [Contributing Guide](CONTRIBUTING.md) for guidelines.

# Who is using VirtualAPK?

<img src="imgs/didi.png" width="78px" align="center" alt="滴滴出行"/> <img src="imgs/uber-china.png" width="78px" align="center" alt="Uber中国"/>

# License

VirtualAPK is licensed under the Apache License 2.0. See the [LICENSE](LICENSE) file.
